После фазы сбора диалоговых данных и генерации параметров неигровых персонажей, включающих в себя идентификаторы, характеристики, мировозрение, мотивацию и слабости, следующим логическим этапом становится подготовка собранных данных к процессу обучения модели. Этот процесс включает в себя конкатенацию данных в строковом формате.

\section{ЭМУЛЯЦИЯ ДИАЛОГОВЫХ ВЗАИМОДЕЙСТВИЙ}

Особое внимание следует уделить диалоговым взаимодействиям между неигровым персонажем и игроком. В контексте датасета, где хранятся полные версии диалогов, эмуляция процесса общения игрока с неигровым персонажем требует разбиения истории диалога на подмножества. В этом случае диалог представляет собой серию ходов между игроком и неигровым персонажем, и основной задачей модели является продолжение данного диалога, т.е. совершение следующего хода в диалоге.

При таком подходе модель обучается на основе итеративного процесса диалога, что способствует приближению к более реалистичному моделированию процесса диалога. Это позволяет на каждом этапе оптимизировать процесс обучения для достижения максимально эффективного результата.

\section{СТРУКТУРИРОВАНИЕ ВХОДНЫХ ДАННЫХ ДЛЯ ОБУЧЕНИЯ}

Для оптимизации процесса обучения, входные последовательности, а именно описание неигрового персонажа, история диалогов с игроком, последняя реплика игрока и реплика, которую должна сгенерировать модель, были разделены на сегменты, каждый из которых был помечен соответствующим образом. Такой подход к структурированию входных данных для модели позволяет ясно разделять различные компоненты входных данных, что облегчает задачу модели и способствует более эффективному обучению.

Для обозначения начала диалога используется уникальный идентификатор <<EMPTY>>, который функционирует как сигнал о том, что диалог только что был инициирован. В силу специфики датасета DNDD, полученного из игр, где неигровые персонажи всегда начинают диалог первыми, было определено, что первая реплика игрока служит активацией диалога, и обозначена она идентификатором <<START DIALOGUE>>. В ходе последующего диалога реплики участников регистрируются в истории диалога с пометками <<Player: >> и <<NPC: >>, в зависимости от того, кто в данный момент выступает в роли говорящего.

\section{ОПТИМИЗАЦИЯ ДАННЫХ ПОД ПОТРЕБИТЕЛЬСКОЕ ОБОРУДОВАНИЕ}

Учитывая ограниченные вычислительные ресурсы потребительского уровня, включая оперативную память объемом 32 гигабайта и графическую карту NVIDIA GeForce RTX 3090 Ti с 24 гигабайтами памяти, было необходимо ввести определенные ограничения на обрабатываемую историю диалогов. При превышении диалогом лимита в 1024 токенов, для обеспечения управляемости данных самые старые записи в диалоге подлежали удалению. Это позволяло оптимизировать использование доступных вычислительных ресурсов и обеспечивать стабильный процесс обучения моделей. 

Также было ограничено максимальное количество диалогов, которых может иметь игрок с одним неигровым персонажем. Это позволяет иметь меньшее, но более разнообразное количество данных.

Итоговые данные выглядят следующим образом.
Входная последовательность:
\texttt{\\Below is the definition of in-game NPC.\\
    NPC Name: Digby\\
    Alignment: Neutral\\
    Description: A burly, bearded man with a thick accent and a penchant for trapping.\\
    Personality traits: Digby is a bit of a glutton, and often overindulges in food and drink.\\
    Flaws: Digby is motivated by the prospect of making a profit from his trapping.\\
    Motivation: Digby is a gruff, no-nonsense man who is quick to anger and slow to trust. He is a hard worker and is not afraid to get his hands dirty. He is also a bit of a glutton, and often overindulges in food and drink.\\
    Dialogue history:\\
    Player: START DIALOGUE\\
    NPC: *burp* Think I had too much to drink last night. Heh! What am I sayin'?! There's no such thing, says my brothers. Hey, who are you, anyway?\\\\
    Player query: Who are you?\\
    Respond to player's query based on defined NPC:\\}

Ожидаемый ответ: \texttt{I'm Digby. I'm a trapper 'round these parts. Me and my brothers catch all sorts of varmints, skin 'em, and sell 'em. Course, it's hard lately now that Emmerich is pokin' 'round.}

Детальная реализация обработки датасета c документацией доступна в приложении \ref{app:code}.